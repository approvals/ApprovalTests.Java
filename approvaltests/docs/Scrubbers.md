<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /approvaltests/docs/mdsource/Scrubbers.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

<a id="top"></a>

# Scrubbers

<!-- toc -->
## Contents

  * [Interface](#interface)
  * [Guid Scrubbing](#guid-scrubbing)
  * [RegEx Scrubbing](#regex-scrubbing)<!-- endToc -->

!(https://raw.githubusercontent.com/approvals/ApprovalTests.cpp/master/doc/images/ScrubberOverview.png)

If you are having trouble getting tests running reproducibly, you might need to use a “scrubber” to convert the non-deterministic text to something stable.

## Interface

Fundamentally, a scrubber is function that takes a string and returns a string. 
You can create ones by passing in a function or a lambda. 
We also have some pre-made ones for your convenience.


## Guid Scrubbing

Let's say you have the following Guids in your output:
<!-- snippet: guid-scrubbing-1 -->
<a id='snippet-guid-scrubbing-1'></a>
```java
String[] guids = {"2fd78d4a-ad49-447d-96a8-deda585a9aa5",
                  "2fd78d4a-1111-1111-1111-deda585a9aa5",
                  "2fd78d4a-3333-3333-3333-deda585a9aa5",
                  "2fd78d4a-ad49-447d-96a8-deda585a9aa5",
                  "2fd78d4a-ad49-447d-96a8-deda585a9aa5 and text"};
```
<sup><a href='/approvaltests-tests/src/test/java/org/approvaltests/scrubbers/ScrubberTest.java#L31-L37' title='File snippet `guid-scrubbing-1` was extracted from'>snippet source</a> | <a href='#snippet-guid-scrubbing-1' title='Navigate to start of snippet `guid-scrubbing-1`'>anchor</a></sup>
<!-- endSnippet -->
You can make this output deterministic by using a scrubber in the options.
For example:
<!-- snippet: guid-scrubbing-2 -->
<a id='snippet-guid-scrubbing-2'></a>
```java
Approvals.verifyAll("guids", guids, new Options(Scrubbers::scrubGuid));
```
<sup><a href='/approvaltests-tests/src/test/java/org/approvaltests/scrubbers/ScrubberTest.java#L38-L40' title='File snippet `guid-scrubbing-2` was extracted from'>snippet source</a> | <a href='#snippet-guid-scrubbing-2' title='Navigate to start of snippet `guid-scrubbing-2`'>anchor</a></sup>
<!-- endSnippet -->
**Note:** Options is available on all Approvals.verify methods.
This will result in the following `.approved.txt` file
<!-- snippet: /src/test/java/org/approvaltests/scrubbers/ScrubberTest.scrubGuids.approved.txt -->
<a id='snippet-/src/test/java/org/approvaltests/scrubbers/ScrubberTest.scrubGuids.approved.txt'></a>
```txt
guids[0] = guid_1
guids[1] = guid_2
guids[2] = guid_3
guids[3] = guid_1
guids[4] = guid_1 and text
```
<sup><a href='/approvaltests-tests/src/test/java/org/approvaltests/scrubbers/ScrubberTest.scrubGuids.approved.txt#L1-L5' title='File snippet `/src/test/java/org/approvaltests/scrubbers/ScrubberTest.scrubGuids.approved.txt` was extracted from'>snippet source</a> | <a href='#snippet-/src/test/java/org/approvaltests/scrubbers/ScrubberTest.scrubGuids.approved.txt' title='Navigate to start of snippet `/src/test/java/org/approvaltests/scrubbers/ScrubberTest.scrubGuids.approved.txt`'>anchor</a></sup>
<!-- endSnippet -->
**Note:** If a Guid is used in multiple places, it will be scrubbed using the same replacement.
That is why you see `guid_1` three times.

## RegEx Scrubbing

Using a regex search term

For example, here is an example where random numbers are scrubbed:
<!-- snippet: scrub-regex-example -->
<a id='snippet-scrub-regex-example'></a>
```java
String input = "Hello " + new Random().nextInt(100) + " World!";
Approvals.verify(input, new Options(new RegExScrubber("(\\d+)", "[number]")));
```
<sup><a href='/approvaltests-tests/src/test/java/org/approvaltests/scrubbers/RegExScrubberTest.java#L14-L17' title='File snippet `scrub-regex-example` was extracted from'>snippet source</a> | <a href='#snippet-scrub-regex-example' title='Navigate to start of snippet `scrub-regex-example`'>anchor</a></sup>
<!-- endSnippet -->
producing
<!-- snippet: /src/test/java/org/approvaltests/scrubbers/RegExScrubberTest.name.approved.txt -->
<a id='snippet-/src/test/java/org/approvaltests/scrubbers/RegExScrubberTest.name.approved.txt'></a>
```txt
Hello [number] World!
```
<sup><a href='/approvaltests-tests/src/test/java/org/approvaltests/scrubbers/RegExScrubberTest.name.approved.txt#L1-L1' title='File snippet `/src/test/java/org/approvaltests/scrubbers/RegExScrubberTest.name.approved.txt` was extracted from'>snippet source</a> | <a href='#snippet-/src/test/java/org/approvaltests/scrubbers/RegExScrubberTest.name.approved.txt' title='Navigate to start of snippet `/src/test/java/org/approvaltests/scrubbers/RegExScrubberTest.name.approved.txt`'>anchor</a></sup>
<!-- endSnippet -->

---

[Back to User Guide](README.md#top)
